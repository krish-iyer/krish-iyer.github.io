<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Week #3 | Krishnan&#39;s blog</title>

    <link rel="stylesheet" href="/css/main.css">


      <script src="/js/main.js"></script>


  
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)']]                  
    },
    loader:{
      load: ['ui/safe']
    },
  };
</script>

  

</head>
<body>
  <header>
    
  <nav class="site-nav">
    <ul class="menu-root">
    <li>
      <a href="/">Home</a>
    </li>
    <li>
      <a href="/publications/">Publications</a>
    </li>
    <li>
      <a href="/files/resume.pdf">CV</a>
    </li>
    <li>
      <a href="/about/">About</a>
    </li>
    <li>
      <a href="/contact/">Contact</a>
    </li>
    </ul>
  </nav>


  </header>
  <main>
    
    <h1 class="post-title">Week #3</h1>

    
    
    <time class="post-date" datetime="2018-05-28T20:35:18&#43;05:30"><em>May 28, 2018</em></time><main class="post-content">
                                  <p>Sorry folks! for the delay in the updates. I was pretty much occupied by end term exams. After initial setup, we divided the our initial plan in following steps.</p>
<ul>
<li>Discover PCI bus</li>
<li>Filter out SDHC device from the connected devices on the bus.</li>
<li>Register the device as the child node.</li>
</ul>
<p>As I was able to load the driver, it exited in between somewhere from the supports_device(). So I broke the conditions where it checks for the bus, device ID and vendor ID, in order to see where exactly it was not satisfying the condition. I also printed bus value, we got to know that the driver was not able to access PCI bus and it&rsquo;s hidden by default. To enable it we need to mention the bus manager(<em>&ldquo;mmc&rdquo;:location://src add-ons/kernel/busses/mmc</em>) path in the device manager(<em>location://src/system/kernel/device_manager device_manager.cpp</em>) where few more busses&rsquo;s paths were hardcoded.</p>
<p>In between this we also did a little hack kinda thing. We knew that virtio can access PCI bus so we changed the driver module name(busses/virtio/sdhci_pci/driver_v1) and manually placed in ~/config/non-packaged/add-ons/kernel/busses/virtio. After which the supports_device() got access to PCI bus.</p>
<p>I resumed the work on adding bus manager(mmc) path in device manager(). After making changes to kernel we need to update the image with the new kernel.</p>
<p>From the host:</p>
<pre><code>cd haiku/generated.x86_64
jam -q update -image kernel
</code></pre>
<p>you can also do that in the haiku guest:</p>
<pre><code>cd haiku/generated.x86_64
jam haiku.hpkg
pkgman install haiku.hpkg
</code></pre>
<p>this will update the kernel but certainly, my system went out of cache memory and got stuck. So I updated from the host and it worked pretty well, you can confirm it by last created or updated date..</p>
<pre><code>ls -l /boot/system/kernel_x86_64
</code></pre>
<p>After updating the kernel we expected our bus manager to now be able to detect the PCI bus but it still didn&rsquo;t happen. So I tried print debug messages from device manager checking for each condition in _GetNextDriverPath(), later I figure out it&rsquo;s not accepting the condition for PCI_base_peripheral 0x08(defined in PCI.h) class.</p>
<p>So, for now, I can interpret that the PCI class is not discoverable to device manager too.</p>
<p>In between the printing debug messages from supports_device(), I crashed the OS due to printing some invalid values(<em>like: gDeviceManager-&gt;get_attr_uint16(parent, B_DEVICE_ID, &amp;deviceID, true)</em>). It will directly boot to kdebug log, I knew that I placed the binary in ~/config/../add-ons so I had to disable loading of drivers from that part.</p>
<p>For recovery, I followed the following steps:</p>
<ul>
<li>In order to boot into the boot menu, press and hold space bar or shift(space bar worked for me), you should be really fast in this. I took more than 40 mins to really get used to it.</li>
<li>Then go to safe mode and disable add-ons.</li>
<li>Come back to the main menu and click on &ldquo;continue booting&rdquo;.</li>
</ul>
<p>At last thanks to Driver1, korli, phoudoin, Pulko Mandy, Alex, axeld for helping me figuring out all of these problems :).</p>

                                </main>


  </main>
  <footer>
    Â© 2025 Krishnan Iyer.
Original content licensed under
<a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>, except where otherwise noted.

  </footer>
</body>
</html>
